var lsButs; var LevelSelectState = {preload: function(){world = this; settings(this); game.stage.backgroundColor = "#000000"; }, create: function() {muPlay('muTitle',1,true); game.wait = 4; game.world.setBounds(-screenWidth,40,screenWidth * 3, screenHeight); game.stage.smoothed = false; addSprite(0,40, 'bgLS'); lsButs = []; addLSButtons(); btnTitle = addSprite(screenWidth / 2, 437, 'btn_Title'); btnTitle.anchor.setTo(0.5); btnTitle.inputEnabled = true; btnTitle.events.onInputDown.add(gotoTitle, this); if(screenShot){screenShot = addSprite(-screenWidth,40, screenShot); game.camera.x = -screenWidth; screenShot.aMinus = 0; } else{game.input.onDown.add(lsClick); } }, update: function(){if(game.wait > 0){game.wait--; return; } if(screenShot){screenShot.alpha += screenShot.aMinus; screenShot.aMinus -= 0.0006; if(screenShot.alpha < 0){screenShot.alpha = 0; } game.camera.x += 10; if(game.camera.x > 0){game.camera.x = 0; screenShot.kill(); screenShot = null; game.input.onDown.add(lsClick); } return; } }, render: function(){if(rotDevice){rotDevice.x = game.camera.x; rotDevice.y = game.camera.y; game.world.bringToTop(rotDevice); } } }; function addLSButtons(){var xx = 0; var yy = 0; var lnr = 1; for (var i = 0; i < 36; i++) {var lsBut = world.game.add.sprite(80 + xx * 70, 120 + yy * 80, 'lsBtn'); lsBut.anchor.setTo(0.5); if(lnr <= game.ldat){lsBut.lnr = lnr; var style = { font: '90px gameFont', fill: '#FFFFFF', wordWrap: false, smoothed: false,wordWrapWidth: null, align: 'center', backgroundColor: null }; var t = game.add.text(lsBut.x, lsBut.y + 0, lnr,style); t.fontSize = 30 * 10; t.scale.setTo(0.1); t.addColor('#625E44'); t.anchor.setTo(0.5); lsButs.push(lsBut); } else{lsBut.frame = 1; } lnr += 1; xx++; if(xx > 8){xx = 0; yy += 1; } } } function lsClick(pointer){if(rotDevice){return;} for (var i = 0; i < lsButs.length; i++) {var b = lsButs[i]; if(b.getBounds().contains(pointer.x, pointer.y)){clickSound(); levl = b.lnr; if(parent && parent.cmgGameEvent){parent.cmgGameEvent('start', levl.toString()); } takeScreenShot(); newState(); } } } function gotoTitle(){clickSound(); takeScreenShot(); levl = 0; newState(); }