var TitleState = {preload: function(){addFocusAndDesktopDetection(); world = this; this.scale.scaleMode = Phaser.ScaleManager.SHOW_ALL; this.scale.pageAlignHorizontally = true; this.scale.pageAlignVertically = true; game.stage.backgroundColor = "#000000"; }, create: function() {game.world.setBounds(-screenWidth,40,screenWidth * 3, screenHeight); addSprite(0,40, 'bgTitle'); var sant = addSprite(459,216 + 40, 'grxTitleSantaAni'); sant.anchor.setTo(0.5,1); sant.animations.add('ani', [0,1,2,3,4], 12,true); sant.play('ani'); var deer = addSprite(80,443, 'deerAni'); deer.scale.x = -1; deer.anchor.setTo(0.5,1); deer.animations.add('ani', [0,1], 2,true); deer.play('ani'); var gFront = addSprite(0,480, 'grxTitleFront'); gFront.anchor.setTo(0,1); addSprite(0,40, 'grxTitleLogo'); var xx = 280; var yy = 320; muPlay('muTitle',1,true); this.btnPlay = world.game.add.sprite(xx, yy, 'btn_play'); this.btnPlay.anchor.setTo(0.5, 0.5); this.btnPlay.inputEnabled = true; game.btnFX = addSprite(xx - 126,yy - 40, 'btn_fx'); game.btnFX.anchor.setTo(0.5); game.btnFX.inputEnabled = true; game.btnFX.events.onInputDown.add(muteFX, this); game.btnMu = addSprite(xx - 126,yy + 40, 'btn_mu'); game.btnMu.anchor.setTo(0.5); game.btnMu.inputEnabled = true; game.btnMu.events.onInputDown.add(muteMu, this); setMuFXBtns(); if(screenShot){screenShot = addSprite(-screenWidth,40, screenShot); game.camera.x = -screenWidth; screenShot.aMinus = 0; } else{this.btnPlay.events.onInputDown.add(gotoL1, this); } }, update: function(){if(screenShot){screenShot.alpha += screenShot.aMinus; screenShot.aMinus -= 0.0006; if(screenShot.alpha < 0){screenShot.alpha = 0; } game.camera.x += 10; if(game.camera.x > 0){game.camera.x = 0; screenShot.destroy(); screenShot = null; this.btnPlay.events.onInputDown.add(gotoL1, this); } return; } }, render: function(){if(rotDevice){rotDevice.x = game.camera.x; rotDevice.y = game.camera.y; game.world.bringToTop(rotDevice); } } }; function gotoL1(){clickSound(); if(parent && parent.cmgGameEvent){parent.cmgGameEvent('start'); } takeScreenShot(); levl = -1; newState(); }